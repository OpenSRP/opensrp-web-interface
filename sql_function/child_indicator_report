CREATE OR REPLACE FUNCTION core.child_indicator_report(filterArray text[])
RETURNS TABLE(indicator_name character varying, indicator_value int
              , total int)
AS $$
DECLARE
  

BEGIN

 DROP TABLE IF EXISTS child_indicator_temp;
 CREATE TEMP TABLE IF NOT EXISTS child_indicator_temp (
  	indicator_name varchar(150) ,  
	indicator_value int NOT NULL DEFAULT 0,  
  	total int NOT NULL DEFAULT 0,  
  	PRIMARY KEY (indicator_name)  
);

EXECUTE 'insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('|| E' \'% of population we are reaching: \',(select count(*) from core."viewJsonDataConversionOfClient" 
where entity_type =' || E' \'child\' ),1000)';



insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of pregnant women counseled:',core.pregnant_women_counseled( filterArray),100);

insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of children under six months who are exclusively breastfeed :',core.exclusively_breastfeed( filterArray),core.under_six_child_mother_counseled(filterArray));
 				
insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of timely introduction of complementary food :',core.breastfeed_and_complementary_foods( filterArray),core.under_six_to_nine_child(filterArray));

insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of children who are growth faltering :',core.growth_faltering( filterArray),core.total_child(filterArray));

insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of children growth faltering for 2 months consecutively :',core.two_month_growth_faltering_consecutively( filterArray),core.total_children_measured_over_two_weigth_record(filterArray));


insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of women with an underweight child committed to a small doable action before next appointment :',core.committed_previous_action( filterArray),core.growth_faltering( filterArray));

insert into child_indicator_temp(indicator_name,indicator_value,total) 
values('% of severely underweight children 6-23 months :',core.severely_underweight( filterArray),core.total_child(filterArray));


RETURN QUERY SELECT  ttable.indicator_name
       , ttable.indicator_value
       , ttable.total       
       from child_indicator_temp ttable;
END;
$$ LANGUAGE plpgsql;

SELECT core.child_indicator_report(array['Jessore','Jhenaidah','Maheshpur','Fatepur','Fatepur:Ward-2','Fatepur:Ward-2:1-KA','Fatepur:Ward-2:1-KA:EPI center']); 

