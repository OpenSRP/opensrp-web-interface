CREATE OR REPLACE FUNCTION core.child_indicator_report(filterArray text[])
RETURNS TABLE(indicator_name character varying, indicator_value int
              , total int)
AS $$
DECLARE
  filterString varchar := '';
  completeCountFilterString varchar := '';  
  div varchar := '';
  dis varchar := '';
  upa varchar := '';
  uni varchar := '';
  war varchar := '';
  sub varchar := '';
  mau varchar := ''; 
  start_date varchar := '';
  end_date varchar := '';
  eitity_type varchar := '';

BEGIN
div := filterArray[1];
  dis := filterArray[2];
  upa := filterArray[3];
  uni := filterArray[4];
  war := filterArray[5];
  sub := filterArray[6];
  mau := filterArray[7]; 
  start_date := filterArray[8];
  end_date := filterArray[9];
  
  eitity_type := 'child';

 
 DROP TABLE IF EXISTS child_indicator_temp;
 CREATE TEMP TABLE IF NOT EXISTS child_indicator_temp (
  	indicator_name varchar(70) ,  
	indicator_value int NOT NULL DEFAULT 0,  
  	total int NOT NULL DEFAULT 0,  
  	PRIMARY KEY (indicator_name)  
);


/*Creating location conditions query string*/
   if (div != '') THEN
       filterString := E' and child.division=\'' || div || E'\'';
   END IF;

   if (dis != '') THEN
       filterString := filterString || E' and child.district=\'' || dis || E'\'';
   END IF;

   if (upa != '') THEN
       filterString := filterString || E' and upazila=\'' || upa || E'\'';
   END IF;

   if (uni != '') THEN
       filterString := filterString || E' and client_union=\'' || uni || E'\'';
   END IF;

   if (war != '') THEN
       filterString := filterString || E' and ward=\'' || war || E'\'';
   END IF;

   if (sub != '') THEN
       filterString := filterString || E' and subunit=\'' || sub || E'\'';
   END IF;

   if (mau != '') THEN
       filterString := filterString || E' and mauzapara=\'' || mau || E'\'';
   END IF;

   completeCountFilterString := filterString;
   
EXECUTE 'insert into child_indicator_temp(indicator_name,indicator_value) 
values('|| E' \'df \',(select count(*) from core."viewJsonDataConversionOfClient" where entity_type =' || E' \'child\' ))';

    
 				

RETURN QUERY SELECT  ttable.indicator_name
       , ttable.indicator_value
       , ttable.total       
       from child_indicator_temp ttable;
END;
$$ LANGUAGE plpgsql;

SELECT core.child_indicator_report(array['Jessore','Jhenaidah','Maheshpur','Fatepur','Fatepur:Ward-2','Fatepur:Ward-2:1-KA','Fatepur:Ward-2:1-KA:EPI center']); 

