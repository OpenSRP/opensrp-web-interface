CREATE OR REPLACE FUNCTION core.under_six_child_mother_counseled (lists varchar[]) 
RETURNS int
AS $$    
    DECLARE totalCount int:=0; 
   
    BEGIN  
    totalCount = (select count(*)
            FROM core."viewJsonDataConversionOfClient" c
            join 
            (SELECT *
             FROM core."viewJsonDataConversionOfEvent" e1
             WHERE '2018-09-02' >= e1.date_created and  e1.event_type='Lactating Woman Counselling' and NOT EXISTS (
               SELECT *
               FROM core."viewJsonDataConversionOfEvent" e2
               WHERE  e1.base_entity_id = e2.base_entity_id
                 AND e1.date_created < e2.date_created
              ) order by e1.base_entity_id desc) as lwce
             on c.base_entity_id = lwce.base_entity_id
            WHERE c.event_type ='Birth Registration' and  lwce.event_type ='Lactating Woman Counselling'
            and DATE_PART('day', '2018-09-02'::timestamp - c.birth_date::timestamp)<=180);
    return totalCount;
  END;
  $$ LANGUAGE 'plpgsql';
  
select core.under_six_child_mother_counseled (array['a9ab3f4d-bee9-4ba9-8951-119ccd215ab9','8c5606b6-d41f-40f0-bdde-d303a830206b','88139eb7-1e7d-496a-8f0d-3b88e061d0a0']);