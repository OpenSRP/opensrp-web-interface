CREATE OR REPLACE FUNCTION core.under_six_child_mother_counseled (conditions varchar,startDate varchar,endDate varchar) 
RETURNS int
AS $$    
    DECLARE totalCount int:=0; 
    dateConditionInEvent varchar := '';
    clientdateBetweenCondition varchar := '';
    underSixAgedCondition varchar := '';
    BEGIN      
    if (startDate != '' AND endDate != '') THEN     	
    	endDate = E'\''||endDate || E'\'';
        startDate = E'\''||startDate || E'\'';
		dateConditionInEvent := dateConditionInEvent || E' and ( event_date between '|| startDate || ' and '
                             || endDate ||')';
        clientdateBetweenCondition := clientdateBetweenCondition || E'  ( birth_date between '|| startDate || ' and '
                             || endDate ||')';
        underSixAgedCondition = ' and ( ( DATE_PART('|| E'\'day\',' || startDate ||'::timestamp - c.birth_date::timestamp)<=180 
        and  birth_date<='|| startDate ||') OR '|| clientdateBetweenCondition || ')';
	ELSE
        
    	endDate = E'\''||NOW()|| E'\'';
		dateConditionInEvent := '';
        underSixAgedCondition = ' and DATE_PART('|| E'\'day\',' || endDate ||'::timestamp - c.birth_date::timestamp)<=180 and  birth_date <'|| endDate;
    END IF;   
    EXECUTE 'select count(*)
            FROM core."viewJsonDataConversionOfClient" c            
            WHERE c.event_type ='|| E' \'Birth Registration\' ' || underSixAgedCondition || conditions  into totalCount;
    return totalCount;
  END;
  $$ LANGUAGE 'plpgsql';
  
  select core.under_six_child_mother_counseled('','2018-06-01','2018-06-05');