CREATE OR REPLACE FUNCTION core.breastfeed_and_complementary_foods (conditions varchar,startDate varchar,endDate varchar) 
RETURNS int
AS $$
    DECLARE json_object json;
    DECLARE item json;
    DECLARE breastFeeding varchar = '';
    DECLARE complementaryFood varchar = '';
    DECLARE breastFeedAndcomplementaryFood int = 2;
    DECLARE childs RECORD;
    DECLARE eventRow RECORD;
    DECLARE totalCount int:= 0; 
    DECLARE totalCountInEvent int:= 0; 
   	eventBetweenDateCondition varchar := '';
    clientdateBetweenCondition varchar :='';
    sixToNineAgedCondition varchar := '';
    BEGIN  
    if (startDate != '' AND endDate != '') THEN 
    	endDate = E'\''||endDate || E'\'';
        startDate = E'\''||startDate || E'\'';
		eventBetweenDateCondition := eventBetweenDateCondition || E' and ( event_date between '|| startDate || ' and '
                             || endDate ||')';
         clientdateBetweenCondition := clientdateBetweenCondition || E'  ( birth_date between '|| startDate || ' and '
                             || endDate ||')';
        sixToNineAgedCondition =' and (
            ( DATE_PART (' || E'\'day\','|| startDate || '::timestamp - c.birth_date::timestamp)>181
                 and  DATE_PART('|| E'\'day\','|| startDate || '::timestamp - c.birth_date::timestamp)<271 and birth_date <'||startDate ||'
                 ) OR ' || clientdateBetweenCondition ||')';
        ELSE
            endDate = E'\''||NOW()|| E'\'';
            eventBetweenDateCondition := '';
            sixToNineAgedCondition =' and (
            ( DATE_PART(' || E'\'day\','|| endDate || '::timestamp - c.birth_date::timestamp)>181
                 and DATE_PART('|| E'\'day\','|| endDate || '::timestamp - c.birth_date::timestamp)<271 and birth_date <='|| endDate ||')
            )';
        END IF;
    	FOR childs IN
             EXECUTE 'SELECT c.base_entity_id as baseEntityId,c.birth_date as dob FROM core."viewJsonDataConversionOfClient" as c  
            WHERE c.event_type =' || E' \'Birth Registration\' '|| conditions || sixToNineAgedCondition
           --  and provider_id='joom'
           -- and base_entity_id ='7d8782d9-ded5-4d57-beab-b9f1b5ef1e73'
            LOOP	
            
            EXECUTE 'SELECT count(*) FROM core."viewJsonDataConversionOfEvent" e  
                WHERE e.event_type ='|| E'\'Lactating Woman Counselling\'                
                and e.base_entity_id ='||E' \''||childs.baseEntityId ||E'\'' || eventBetweenDateCondition into totalCountInEvent ;
            IF totalCountInEvent != 0
            THEN
            FOR eventRow IN 
                EXECUTE 'SELECT * FROM core."viewJsonDataConversionOfEvent" e  
                WHERE e.event_type ='|| E'\'Lactating Woman Counselling\'                
                and e.base_entity_id ='||E' \''||childs.baseEntityId ||E'\'' || eventBetweenDateCondition 
               
                LOOP                	
                	breastfeeding = eventRow.breastfeeding;                
                    complementaryFood = eventRow.complimentary_amount;
                    IF breastfeeding = 'No'  OR complementaryFood ='0' OR complementaryFood IS NULL
                        THEN
                        breastFeedAndcomplementaryFood = 1;
                        Exit  ;
                     ELSE
                     breastFeedAndcomplementaryFood = 0;
                    END IF;
                    
                END LOOP;
            ELSE
            	breastFeedAndcomplementaryFood  = 1;
			END IF	;
            IF breastFeedAndcomplementaryFood = 0
            	THEN 
                totalCount = totalCount+1;
                --RAISE NOTICE 'i want to print % ', breastFeedAndcomplementaryFood;
            END IF;
   		END LOOP;
    return totalCount;
  END;
  $$ LANGUAGE 'plpgsql';
  
  
   select core.breastfeed_and_complementary_foods('','2018-03-01','2018-08-01');
   select core.breastfeed_and_complementary_foods('','','');